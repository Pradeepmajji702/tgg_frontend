<div class="main-page">
  <div class="pin-changer-container">
    <!-- <div class="logo-box">
      <img src="assets/lo" alt="JB HI-FI Logo" class="jb-logo">
    </div> -->
    <h1>STAFF PIN CHANGER</h1>

    <form [formGroup]="pinChangeForm" class="pin-changer-form">
      <div class="form-group">
        <label for="staffSelect">Choose Staff</label>
        <div class="select-container">
          @if (isLoading) {
            <div class="loading-spinner">Loading staff list...</div>
          } @else if (errorMessage) {
            <div class="error-message">{{errorMessage}}</div>
          } @else {
            <select id="staffSelect" formControlName="selectedStaff">
              <option value="" selected>Select staff</option>
              @for (staff of staffList; track staff.empId) {
                <option [value]="staff.empId">{{getFullName(staff)}}</option>
              }
            </select>
          }
        </div>
        <div class="staff-id">{{getSelectedStaffId()}}</div>
      </div>

      <div class="form-group">
        <label for="newPin">Enter New Staff PIN</label>
        <div class="input-container">
          <input type="number"
                 id="newPin"
                 formControlName="newPin"
                 [maxlength]="getSelectedStaffLevel() >= 3 ? 5 : 4"
                 [class.error]="pinChangeForm.get('newPin')?.invalid && pinChangeForm.get('newPin')?.touched">
          <div class="checkbox-container">
            <input type="checkbox"
                   id="isManager"
                   formControlName="isManager">
            <label for="isManager" [class.disabled]="getSelectedStaffLevel() < 3">Manager</label>
            @if (getSelectedStaffLevel() >= 3) {
              <button type="button" class="pin-generator" (click)="generateRandomPin()" title="Generate Random PIN">
                <div class="refresh-circle">
                  <svg viewBox="0 0 24 24" class="refresh-icon">
                    <path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                  </svg>
                </div>
              </button>
            }
          </div>
        </div>
        @if (pinChangeForm.get('newPin')?.invalid && pinChangeForm.get('newPin')?.touched) {
          <div class="error-message">
            {{ getPinErrorMessage() }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="managerPin">Manager PIN Authorisation</label>
        <input type="password" id="managerPin" formControlName="managerPin" style="height: 15px;width: 273px;">
      </div>

      <div class="button-group">
        <button type="button" (click)="onChangePin()" class="change-pin">
          <div class="key-icon">
            <svg viewBox="0 0 24 24">
              <path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
            </svg>
          </div>
          Change PIN
        </button>
        <button type="button" (click)="onQuit()" class="quit">
          <div class="quit-icon">
            <svg viewBox="0 0 24 24">
              <path class="folder" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2z"/>
              <path class="arrow" d="M12 10l-4 4h3v6h2v-6h3z"/>
            </svg>
          </div>
          Quit
        </button>
      </div>

      @if (apiMessage) {
        <div class="api-message" [class.error]="isError" [class.success]="!isError">
          {{apiMessage}}
        </div>
      }
    </form>
  </div>
</div>

